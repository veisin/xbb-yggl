<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>цЬмхЬ░цХ░цНочобчРЖч│╗ч╗Я</title>
    <link rel="icon" href="css/icons-mao.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css/yuangong.css">
    <link rel="stylesheet" href="css/data_processor.css">
    <link rel="stylesheet" href="css/staff-accommodation.css">
    <link rel="stylesheet" href="css/employee-toapartment.css">
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/xlsx.full.min.js"></script>
    <script src="js/exceljs.min.js"></script>
    <script src="js/FileSaver.min.js"></script>


</head>
<body>

<div class="wrapper">
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3 class="nav-title">ЁЯРЪЁЯР▒чЪДцХ░цНочобчРЖч│╗ч╗Я</h3>
            <div id="sidebarCollapse" class="toggle-icon">тШ░</div>
        </div>

        <ul class="list-unstyled components">
            <li class="nav-item">
                <div class="nav-link action-btn" data-id="create-table" data-type="module" data-title="хИЫх╗║цЦ░шбица╝">
                    <span class="icon">тЮХ</span><span class="menu-text">хИЫх╗║цЦ░шбица╝</span>
                </div>
            </li>

            <li class="nav-item">
                <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="icon">ЁЯУВ</span><span class="menu-text">шбица╝цХ░цНоцЯечЬЛ</span>
                    <span class="arrow">тЦ╝</span>
                </a>
                <ul class="collapse list-unstyled" id="tableMenu">
                    </ul>
            </li>

            <li class="nav-item">
                <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="icon">ЁЯк╢</span><span class="menu-text">шбицХ░цНоф┐оцФ╣ч╗┤цКд</span>
                    <span class="arrow">тЦ╝</span>
                </a>
                <ul class="collapse list-unstyled">
                    <li class="nav-link" data-id="employee-toapartment" data-type="module" data-title="хСШх╖ехЕеф╜ПхЕмхпУ"><span class="icon">ЁЯПа</span><span class="menu-text">хСШх╖ехЕеф╜Пшо╛ч╜о</span></li>
                    <li class="nav-link" data-id="employee-addmove" data-type="module" data-title="хСШх╖ечобчРЖ"><span class="icon">ЁЯПа</span><span class="menu-text">хСШх╖ецХ░цНочобчРЖ</span></li>
                    <!-- <li class="nav-link" data-id="report-duplicate" data-type="module" data-title="хСШх╖ецЯещЗН"><span class="icon">ЁЯСе</span><span class="menu-text">хСШх╖ецЯещЗН</span></li> -->
                </ul>
            </li>

            <li class="nav-item">
                <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="icon">ЁЯУИ</span><span class="menu-text">хРДчзНцКешбих▒Хчд║</span>
                    <span class="arrow">тЦ╝</span>
                </a>
                <ul class="collapse list-unstyled">
                    <li class="nav-link" data-id="staff-accommodation" data-type="module" data-title="хСШх╖еф╜Пхо┐"><span class="icon">ЁЯФН</span><span class="menu-text">хСШх╖еф╜Пхо┐цгАц╡Л</span></li>
                    <li class="nav-link" data-id="report-duplicate" data-type="module" data-title="хСШх╖ецЯещЗН"><span class="icon">ЁЯСе</span><span class="menu-text">хСШх╖ецЯещЗН</span></li>
                </ul>
            </li>

            <li class="nav-item">
                <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="icon">ЁЯТ╛</span><span class="menu-text">хдЗф╗╜чобчРЖ</span>
                    <span class="arrow">тЦ╝</span>
                </a>
                <ul class="collapse list-unstyled">
                    <li class="nav-link" data-id="backup-export" data-type="module" data-title="хЕих║УцХ░цНохп╝хЗ║"><span class="icon">ЁЯУд</span><span class="menu-text">цХ░цНох║Ухп╝хЗ║</span></li>
                    <!-- <li class="nav-link" data-id="backup-export" data-type="module" onclick="handleFullDatabaseExport()" data-title="хЕих║УцХ░цНохп╝хЗ║"><span class="icon">ЁЯУд</span><span class="menu-text">цХ░цНох║Ухп╝хЗ║</span></li> -->
                    <li class="nav-link" data-id="backup-restore" data-type="module" data-title="хЕих║УцХ░цНош┐ШхОЯ"><span class="icon">ЁЯУе</span><span class="menu-text">цХ░цНох║Уш┐ШхОЯ</span></li>
                    <li class="nav-link" data-id="schema-manage" data-type="module" data-title="ф┐оцФ╣шбичЪДхИЧч╗УцЮД"><span class="icon">ЁЯУЭ</span><span class="menu-text">ф┐оцФ╣шбихРН/хнЧцо╡</span></li>
                    <!-- <li class="nav-link" data-id="backup-history" data-type="module" data-title="хОЖхП▓х┐лчЕз"><span class="icon">ЁЯУЬ</span><span class="menu-text">хОЖхП▓х┐лчЕз</span></li> -->
                </ul>
            </li>

<!--             <li class="nav-item">
                <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="icon">ЁЯЫая╕П</span><span class="menu-text">шбич╗УцЮДчобчРЖ</span>
                    <span class="arrow">тЦ╝</span>
                </a>
                <ul class="collapse list-unstyled">
                    <li class="nav-link" data-id="schema-manage" data-type="module" data-title="ф┐оцФ╣ч╗УцЮД"><span class="icon">ЁЯУЭ</span><span class="menu-text">ф┐оцФ╣шбихРН/хнЧцо╡</span></li>
                    <li class="nav-link" data-id="schema-delete" data-type="module" data-title="хИащЩдшбица╝"><span class="icon">тЭМ</span><span class="menu-text">хИащЩдшбица╝</span></li>
                </ul>
            </li> -->

            <hr class="menu-divider">

            <li class="nav-link nav-item" data-id="dashboard" data-type="module" data-title="ф╗кшбичЫШхИЖцЮР">
                <span class="icon">ЁЯУК</span><span class="menu-text">ф╗кшбичЫШхИЖцЮР</span>
            </li>
            <li class="nav-link nav-item" data-id="processing" data-type="module" data-title="шбица╝цХ░цНохдДчРЖ">
                <span class="icon">ЁЯУС</span><span class="menu-text">шбица╝цХ░цНохдДчРЖ</span>
            </li>
            <li class="nav-link nav-item" data-id="settings" data-type="module" data-title="ч│╗ч╗Яшо╛ч╜о">
                <span class="icon">тЪЩя╕П</span><span class="menu-text">ч│╗ч╗Яшо╛ч╜о</span>
            </li>
        </ul>
    </nav>


    <!-- ф┐оцФ╣шбичЪД хИЧхРН -->
    <div id="modalEditSchema" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ф┐оцФ╣шбич╗УцЮД</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editSchemaId">
                <div class="form-group">
                    <label>шбица╝цШ╛чд║хРНчз░:</label>
                    <input type="text" id="editSchemaTitle" class="form-control">
                </div>
                <div class="form-group">
                    <label>хнЧцо╡хоЪф╣Й (щАЧхП╖щЪФх╝А):</label>
                    <textarea id="editSchemaColumns" class="form-control" rows="5"></textarea>
                    <small style="color:red;">ц│ицДПя╝Ъф┐оцФ╣хнЧцо╡хРНф╝Ъхп╝шЗ┤цЧзцХ░цНоф╕нхп╣х║ФчЪДхИЧф╕вхд▒я╝Б</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel">хПЦц╢И</button>
                <button class="btn-confirm" onclick="handleSaveSchema()">ф┐ЭхнШф┐оцФ╣</button>
            </div>
        </div>
    </div>

    <!-- хИЭхзЛхМЦцПРчд║шпн -->
    <div id="content">
        <div id="tabHeader" class="tab-header"></div>
        <div id="mainView" class="main-content">
            <div class="tabs-wrapper">
                <ul id="tabStrip" class="tab-strip"></ul>
            </div>
            <div id="tabContent" class="tab-content-area">
                <div class="welcome-screen">
                    <h3>цмвш┐Оф╜┐чФичобчРЖч│╗ч╗Я</h3>
                    <p>шп╖ф╗Ох╖жф╛зшПЬхНХщАЙцЛйф╕Аф╕кшбица╝х╝АхзЛцУНф╜Ь</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ф║МщАЙф╕А + sheetщАЙцЛй цбЖ -->
<div id="sheetSelectModal" class="custom-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:999999; justify-content:center; align-items:center;">
    <div style="background:white; padding:25px; border-radius:12px; width:350px;">
        <h3>щАЙцЛйх╖еф╜Ьшби</h3>
        <select id="sheetDropdown" style="width:100%; margin:20px 0; padding:10px;"></select>
        <div style="display:flex; gap:10px; flex-direction:column;">
            <button id="sheetBtnConfirm" style="background:#27ae60; color:white; border:none; padding:10px;">чбошод</button>
            <button id="sheetBtnCancel" style="background:#95a5a6; color:white; border:none; padding:10px;">хПЦц╢И</button>
        </div>
    </div>
</div>
<div id="choiceModal" class="custom-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
    <div class="modal-content" style="background:white; padding:20px; border-radius:8px; width:350px; text-align:center;">
        <h3 id="choiceTitle"></h3>
        <p id="choiceMessage" style="margin:15px 0;"></p>
        <div class="choice-button-group" style="display:flex; flex-direction:column; gap:10px;">
            <button id="choiceBtn1" class="btn-confirm"></button>
            <button id="choiceBtn2" class="btn-confirm" style="background:#e67e22;"></button>
            <button id="choiceBtnCancel" class="btn-cancel"></button>
        </div>
    </div>
</div>

<!-- хп╝хЗ║щЕНч╜оцибцАБцбЖ -->
<div id="exportConfigModal" class="custom-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:999999; justify-content:center; align-items:center;">
    <div class="modal-content" style="background:white; padding:25px; border-radius:12px; width:450px; max-height:90vh; overflow-y:auto;">
        <h3 style="border-bottom:2px solid #eee; padding-bottom:10px;">ЁЯУК хп╝хЗ║шЗкхоЪф╣Йшо╛ч╜о</h3>
        
        <div style="text-align: left; margin-top:15px; display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div>
                <label style="font-size:12px; color:#666;">шбихд┤шГМцЩп</label>
                <input type="color" id="headerBgColor" value="#46BDC6" style="width:100%; height:35px;">
            </div>
            <div>
                <label style="font-size:12px; color:#666;">шбихд┤цЦЗхнЧ</label>
                <input type="color" id="headerFontColor" value="#ffffff" style="width:100%; height:35px;">
            </div>
        </div>

        <div style="margin-top:20px; text-align:left;">
            <label style="font-weight:bold;">ЁЯМЯ щлШф║очЙ╣хоЪхИЧшо╛ч╜о</label>
            <div style="display:flex; gap:10px; margin-top:5px;">
                <select id="highlightColIndex" style="flex:1; padding:8px; border-radius:5px; border:1px solid #ddd;">
                    </select>
                <input type="color" id="colHighlightColor" value="#FFF2CC" style="width:50px; height:38px;">
            </div>
            <p style="font-size:11px; color:#999; margin-top:5px;">цПРчд║я╝ЪщАЙцЛйф╕АхИЧя╝Мх╣╢ф╕║хЕ╢шо╛ч╜ошГМцЩпщвЬшЙ▓уАВ</p>
        </div>

        <div style="margin-top:20px; text-align:left;">
            <label><input type="checkbox" id="autoWidth" checked> шЗкхКиф╝ШхМЦхИЧхо╜ (щШ▓цнвцЦЗхнЧщБоцМб)</label>
        </div>

        <div style="margin-top:25px; display:flex; gap:10px;">
            <button id="btnDoExport" style="flex:1; background:#2ecc71; color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:bold;">чбошодхп╝хЗ║</button>
            <button id="btnCancelExport" style="flex:1; background:#95a5a6; color:white; border:none; padding:12px; border-radius:8px; cursor:pointer;">хПЦц╢И</button>
        </div>
    </div>
</div>

<!-- шбица╝цХ░цНоцЦ░хвЮ -->
<div id="dataEntryModal" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="width: 80%; max-width: 1000px;">
        <div class="modal-header">
            <h4>тЮХ цЦ░хвЮцХ░цНо - <span id="entryTableTitle"></span></h4>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="dataEntryForm" class="dynamic-form">
                </form>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">хПЦц╢И</button>
            <button class="btn-confirm" id="saveDataRowBtn">чбошодц╖╗хКа</button>
        </div>
    </div>
</div>
<!-- чбошодцбЖх╝╣хЗ║цбЖ -->
<div id="confirmModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;"> <div class="modal-header">
            <h4 id="confirmTitle">чбошодцУНф╜Ь</h4>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p id="confirmMessage" style="font-size: 15px; color: #34495e; line-height: 1.5;"></p>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" id="confirmBtnCancel">хПЦц╢И</button>
            <button class="btn-confirm btn-danger" id="confirmBtnOk">чбохоЪ</button>
        </div>
    </div>
</div>
<!-- хРРхП╕цбЖ -->
<div id="toast-container"></div>
<script src="js/db.js"></script>
<script src="js/yuangong.js"></script>
<script src="js/data_processor.js"></script>
<script src="js/staff-accommodation.js"></script>
<script src="js/employee-toapartment.js"></script>
</body>
</html>